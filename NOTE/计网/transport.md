# 传输层-->不太会TCP所以写写
## 传输层服务概览
* multiplexing and demultiplexing 多路复用和多路分解
* UDP 不可靠/无连接的服务 用户数据报协议 User Datagram Protocol
* 可靠数据传输原则
* TCP 传输控制协议 可靠的/面向连接的服务 connection-oriented transport Transmission Control Protocol
* 拥塞控制原则 congestion-control principles
* SYN ACK
### 多路复用和多路分解
由网络层提供的主机到主机的交付服务延伸到为运行在主机上的应用程序提供进程到进程的交付服务。
* 在目的主机，运输层从网络层接收报文段。运输层负责将这些报文段中的数据交付给主机上运行的适当应用程序进程。
    * 一个进程有一个/多个套接字socket，相当于从网络向进程传递数据和从进程向网络传递数据的门户。
    * 接收主机的运输层实际上并没有直接将数据交付给进程，而是将数据交付给一个中间的套接字。
    * 在任一时刻，接收主机上可能不止有一个套接字，所以每个套接字都有唯一的标识符。标识符的格式取决于它是UDP还是TCP套接字。
* 发送方的复用：处理来自不同套接字的数据，添加传输头
* 接收方的解复用：使用传输头信息分配接收到的segments（报文段）到正确的套接字
    * 主机接收IP数据报：每个数据报都有源IP地址，目的地IP地址；每个数据报都携带了传输层报文段；每个报文段有源端口/目的的端口
    * 主机使用IP地址/端口号把报文段导向正确的应用层套接字
#### 无连接的解复用——UDP
* 当创建套接字时，必须specify（具体指明/明确说明）主机端口号
* 创建数据报到套接字时，必须指明目的地IP地址/目的地端口
* 当接收方主机接收到UDP报文段时——二元组标识
    * 检查报文段中的目的地端口号
    * 将UDP报文段导向正确的有该端口号的套接字
* IP/UDP数据报拥有一样的目的地端口号但是不同的源端口号/源IP地址会被导向接收方主机的同一个套接字。
#### 连接定向的解复用——TCP
* TCP套接字由四元组标识：源/端IP/port
* 接收方通过这四个值将报文段导向正确的套接字
* 服务提供方支持同时许多个TCP套接字
    * 每个套接字由四元组标识
#### Summary
* 复用，解复用基于报文段/数据报头域名信息
    * UDP：解复用使用目的地端口值
    * TCP：解复用使用四元组
* 复用/解复用在每个层上都会发生。
### TCP
* connection-oriented面向连接的，点对点连接
* 一个应用进程在向另一个进程发送数据之前，必须先“握手”——即相互发送某些预备报文段，以建立确保数据传输的参数。连接的双方都将初始化与TCP连接相关的许多TCP状态变量。
* TCP报文段结构
    * 源端口号 目的地端口号
    * 检验和字段 checksum field
    * 32bit的序号字段（sequence number field）
    * 32bit的确认号字段（acknowledgement number field）
    * 16bit的接收窗口字段（receive window field） 流量控制，指示接收方愿意接受的字节数量
    * 4bit的首部长度字段，指示TCP首部长度
    * 可选与变长的选项字段
    * 6bit的标志字段。ACK比特用于指示确认字段的有效性，RST/SYN/FIN用于连接建立和拆除。
#### 三次握手和四次挥手
* client-->server SYN
    * 第一次握手
    * 序列号seq=0
    * 确认号ack=0
    * 同步字符SYN=1-->请求建立连接 客户端准备好了，请求建立连接
* client<--server SYN,ACK
    * 第二次握手
    * 序列号seq=0
    * 确认号ack=1 //第一次握手请求包的序列号+1，值为n，说明n-1位置的所有数据都已正确接收到
    * 确认字符ACK=1
    * 同步序号SYN=1-->服务端也请求连接 服务端接收了客户端的请求，也准备好了
* client-->server ACK
    * 第三次握手
    * 序列号seq=1
    * 确认号ack=1
    * 确认字符ack=1-->客户端表示知道了服务端准备好了
* client<-->server Connection Established
* client-->server SYN,FIN
* client<--server ACK
* client<--server FIN,ACK